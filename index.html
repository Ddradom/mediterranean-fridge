<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Mediterranean Fridge</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root { --color-primary: #10B981; }
    body { font-family: 'Inter', sans-serif; background:#f7f9fb; min-height:100vh; }
    .recipe-card { box-shadow: 0 8px 18px rgba(0,0,0,0.06); }
    .custom-scrollbar::-webkit-scrollbar { width:8px; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: var(--color-primary); border-radius:10px; }
  </style>
</head>
<body>
  <div class="max-w-4xl mx-auto p-6 md:p-10">
    <header class="text-center mb-8">
      <h1 class="text-5xl font-extrabold text-gray-800 mb-2">
        <span class="text-green-600">The</span> <span class="text-blue-600">Mediterranean</span> Fridge
      </h1>
      <p class="text-lg text-gray-500">Type what you have in your fridge and get a Mediterranean recipe (with quantities and step-by-step).</p>
    </header>

    <section class="bg-white p-6 rounded-xl shadow-md border-t-4 border-green-500 mb-8">
      <h2 class="text-2xl font-bold text-gray-700 mb-4">What's in your fridge?</h2>
      <textarea id="ingredients-input" rows="3"
        class="w-full p-4 border-2 border-gray-200 rounded-lg focus:ring-green-300"
        placeholder="e.g., canned chickpeas, lemon, olive oil, cucumber, parsley, feta"></textarea>

      <div class="flex gap-3 mt-4">
        <button id="find-btn" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700">Find Recipes</button>
        <button id="clear-btn" class="px-4 py-3 rounded-lg border border-gray-200">Clear</button>
      </div>

      <p id="hint" class="mt-3 text-sm text-gray-500">Tip: include pantry items like olive oil, salt, pepper, lemon, garlic to enable full recipes.</p>
    </section>

    <section id="results-section">
      <div id="results" class="grid grid-cols-1 gap-6"></div>
      <p id="no-results" class="text-center text-gray-500 mt-6 hidden">No recipes found. Try adding common items like olive oil, lemon, garlic.</p>
    </section>

    <footer class="mt-8 text-sm text-gray-500 text-center">This runs entirely in your browser — no login required.</footer>
  </div>

  <!-- Modal -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
    <div class="bg-white rounded-xl p-6 w-full max-w-2xl shadow-2xl">
      <h3 id="modal-title" class="text-xl font-bold text-gray-900 mb-2"></h3>
      <div id="modal-body" class="text-gray-700"></div>
      <div class="mt-4 text-right">
        <button id="modal-close" class="px-4 py-2 rounded-lg border border-gray-200">Close</button>
      </div>
    </div>
  </div>

<script>
/* ============================
   Recipe database (client-side)
   Each recipe has: name, ingredients (item, qty, note), steps array
   ============================ */
const RECIPES = [
  {
    name: "Mediterranean Tomato & Feta Salad",
    ingredients: [
      { item: "tomato", qty: "2 medium", note: "ripe, chopped" },
      { item: "cucumber", qty: "1/2", note: "sliced" },
      { item: "feta cheese", qty: "75 g (1/3 cup)", note: "crumbled" },
      { item: "red onion", qty: "1/4", note: "thinly sliced" },
      { item: "olive oil", qty: "2 tbsp", note: "extra virgin" },
      { item: "lemon", qty: "1", note: "juiced" },
      { item: "fresh parsley", qty: "2 tbsp", note: "chopped" },
      { item: "dried oregano", qty: "1/2 tsp", note: "optional" },
      { item: "salt", qty: "to taste", note: "" },
      { item: "black pepper", qty: "to taste", note: "" }
    ],
    steps: [
      "Wash and chop the tomatoes into bite-sized pieces. Place in a mixing bowl.",
      "Slice the cucumber and add to the bowl with the tomatoes.",
      "Thinly slice the red onion and add to the vegetables.",
      "Crumble the feta cheese over the salad.",
      "In a small bowl, whisk together the olive oil, lemon juice, dried oregano (if using), salt, and black pepper.",
      "Pour the dressing over the salad and toss gently to combine.",
      "Sprinkle chopped fresh parsley on top and serve immediately (or chill 10–15 minutes to meld flavors)."
    ]
  },
  {
    name: "Lemon Garlic Chicken (Simple Roast)",
    ingredients: [
      { item: "chicken breasts (boneless)", qty: "2", note: "about 180–220 g each" },
      { item: "olive oil", qty: "2 tbsp", note: "" },
      { item: "lemon", qty: "1", note: "zest + juice" },
      { item: "garlic cloves", qty: "3", note: "minced" },
      { item: "dried oregano", qty: "1 tsp", note: "" },
      { item: "salt", qty: "3/4 tsp", note: "" },
      { item: "black pepper", qty: "1/2 tsp", note: "" }
    ],
    steps: [
      "Preheat oven to 400°F (200°C).",
      "In a bowl, mix olive oil, lemon zest and juice, minced garlic, oregano, salt, and pepper to make a marinade.",
      "Place chicken breasts in a baking dish and pour the marinade over them. Let sit 10–20 minutes (or up to 2 hours in fridge).",
      "Bake in the preheated oven for 20–28 minutes, or until internal temperature reaches 165°F (74°C).",
      "Remove from oven, let rest 5 minutes, then slice and serve with pan juices spooned over."
    ]
  },
  {
    name: "Chickpea Mediterranean Bowl",
    ingredients: [
      { item: "canned chickpeas", qty: "1 can (400 g)", note: "drained and rinsed" },
      { item: "olive oil", qty: "1 tbsp", note: "" },
      { item: "tomato", qty: "1 medium", note: "chopped" },
      { item: "spinach or arugula", qty: "2 cups", note: "fresh" },
      { item: "lemon", qty: "1/2", note: "juiced" },
      { item: "ground cumin", qty: "1/2 tsp", note: "" },
      { item: "salt", qty: "to taste", note: "" },
      { item: "black pepper", qty: "to taste", note: "" }
    ],
    steps: [
      "Heat olive oil in a skillet over medium heat.",
      "Add the chickpeas and sauté for 4–6 minutes until slightly crisp. Sprinkle cumin, salt and pepper during cooking.",
      "Remove from heat and toss chickpeas with chopped tomato and fresh greens in a bowl.",
      "Drizzle lemon juice and an extra splash of olive oil, toss gently and serve warm or at room temperature."
    ]
  },
  {
    name: "Greek Yogurt Parfait",
    ingredients: [
      { item: "Greek yogurt", qty: "1 cup (240 g)", note: "plain" },
      { item: "honey", qty: "1 tbsp", note: "" },
      { item: "walnuts", qty: "2 tbsp", note: "chopped" },
      { item: "berries", qty: "1/2 cup", note: "fresh or frozen" }
    ],
    steps: [
      "Spoon half the Greek yogurt into a bowl or glass.",
      "Add half the berries, then a drizzle of honey, and half the chopped walnuts.",
      "Repeat the layers with remaining yogurt, berries, honey, and walnuts.",
      "Serve immediately."
    ]
  }
];

/* ============================
   Matching logic
   - Lowercase, trim
   - Count fuzzy matches: fridge item includes ingredient term or vice versa
   - Rank by match ratio
   ============================ */
function findMatchingRecipes(fridgeItems) {
  const items = fridgeItems.map(s => s.toLowerCase().trim()).filter(Boolean);
  if (!items.length) return [];

  const scored = RECIPES.map(recipe => {
    const required = recipe.ingredients.map(i => i.item.toLowerCase());
    let matches = 0;
    for (const it of items) {
      for (const req of required) {
        if (it.includes(req) || req.includes(it) || req.split(' ')[0] === it.split(' ')[0]) {
          matches++;
          break;
        }
      }
    }
    return { recipe, matches, total: required.length };
  })
  .filter(x => x.matches > 0)
  .sort((a,b) => {
    const aScore = a.matches / a.total;
    const bScore = b.matches / b.total;
    if (bScore !== aScore) return bScore - aScore;
    return b.matches - a.matches;
  })
  .map(x => x.recipe);

  return scored;
}

/* ============================
   UI code
   ============================ */
const findBtn = document.getElementById('find-btn');
const clearBtn = document.getElementById('clear-btn');
const inputEl = document.getElementById('ingredients-input');
const resultsEl = document.getElementById('results');
const noResultsEl = document.getElementById('no-results');

findBtn.addEventListener('click', () => {
  const raw = inputEl.value;
  const list = raw.split(',').map(s => s.trim()).filter(Boolean);
  const matches = findMatchingRecipes(list);
  renderResults(matches);
});

clearBtn.addEventListener('click', () => {
  inputEl.value = '';
  resultsEl.innerHTML = '';
  noResultsEl.classList.add('hidden');
});

function renderResults(recipes) {
  resultsEl.innerHTML = '';
  if (!recipes.length) {
    noResultsEl.classList.remove('hidden');
    return;
  }
  noResultsEl.classList.add('hidden');

  recipes.forEach((r, idx) => {
    const card = document.createElement('div');
    card.className = 'recipe-card bg-white p-5 rounded-xl border border-gray-100';

    // summary HTML
    const summary = `
      <div class="flex justify-between items-start">
        <div>
          <h3 class="text-xl font-semibold text-gray-900">${escapeHtml(r.name)}</h3>
          <p class="text-sm text-gray-600 mt-1">Includes: ${r.ingredients.map(i => escapeHtml(i.item)).join(', ')}</p>
        </div>
        <div>
          <button data-idx="${idx}" class="view-btn text-sm text-blue-600 hover:underline">View</button>
        </div>
      </div>
    `;
    card.innerHTML = summary;
    resultsEl.appendChild(card);
  });

  // Attach click handlers for view buttons
  document.querySelectorAll('.view-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const i = Number(e.currentTarget.dataset.idx);
      showModal(recipes[i]);
    });
  });
}

/* Modal: show full recipe (ingredients + step-by-step) */
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modal-title');
const modalBody = document.getElementById('modal-body');
const modalClose = document.getElementById('modal-close');

modalClose.addEventListener('click', () => { modal.classList.add('hidden'); });

function showModal(recipe) {
  modalTitle.textContent = recipe.name;
  let html = '<h4 class="font-semibold text-gray-800 mt-2">Ingredients</h4><ul class="list-disc list-inside text-gray-700 mt-2">';
  recipe.ingredients.forEach(ing => {
    const note = ing.note ? ` — ${ing.note}` : '';
    html += `<li><strong>${escapeHtml(ing.qty)}</strong> ${escapeHtml(ing.item)}${escapeHtml(note)}</li>`;
  });
  html += '</ul>';
  html += '<h4 class="font-semibold text-gray-800 mt-4">Step-by-step Instructions</h4><ol class="list-decimal list-inside text-gray-700 mt-2">';
  recipe.steps.forEach(step => {
    html += `<li class="mb-2">${escapeHtml(step)}</li>`;
  });
  html += '</ol>';
  modalBody.innerHTML = html;
  modal.classList.remove('hidden');
}

/* Simple HTML escape */
function escapeHtml(str) {
  if (!str) return '';
  return String(str).replace(/[&<>"'`]/g, (s) => ({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;', '`':'&#96;' })[s]);
}
</script>
</body>
</html>
