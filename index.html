import React, { useState } from "react";

// --- Rich Mediterranean Recipe Generator (with quantities & step-by-step instructions) ---
// Each recipe includes: name, ingredients (with quantity/unit), and an ordered list of steps.
const recipes = [
  {
    name: "Mediterranean Tomato & Feta Salad",
    ingredients: [
      { item: "tomato", qty: "2 medium", note: "ripe, chopped" },
      { item: "cucumber", qty: "1/2", note: "sliced" },
      { item: "feta cheese", qty: "75 g (1/3 cup)", note: "crumbled" },
      { item: "red onion", qty: "1/4", note: "thinly sliced" },
      { item: "olive oil", qty: "2 tbsp", note: "extra virgin" },
      { item: "lemon", qty: "1", note: "juiced" },
      { item: "fresh parsley", qty: "2 tbsp", note: "chopped" },
      { item: "dried oregano", qty: "1/2 tsp", note: "optional" },
      { item: "salt", qty: "to taste" },
      { item: "black pepper", qty: "to taste" }
    ],
    steps: [
      "Wash and chop the tomatoes into bite-sized pieces. Place in a mixing bowl.",
      "Slice the cucumber and add to the bowl with the tomatoes.",
      "Thinly slice the red onion and add to the vegetables.",
      "Crumble the feta cheese over the salad.",
      "In a small bowl, whisk together the olive oil, lemon juice, dried oregano (if using), salt, and black pepper.",
      "Pour the dressing over the salad, toss gently to combine.",
      "Sprinkle chopped fresh parsley on top and serve immediately or chill 10-15 minutes for flavors to meld."
    ]
  },
  {
    name: "Lemon Garlic Chicken (Simple Roast)",
    ingredients: [
      { item: "chicken breasts (boneless)", qty: "2", note: "about 180-220 g each" },
      { item: "olive oil", qty: "2 tbsp" },
      { item: "lemon", qty: "1", note: "zest + juice" },
      { item: "garlic cloves", qty: "3", note: "minced" },
      { item: "dried oregano", qty: "1 tsp" },
      { item: "salt", qty: "3/4 tsp" },
      { item: "black pepper", qty: "1/2 tsp" }
    ],
    steps: [
      "Preheat oven to 400°F (200°C).", 
      "In a bowl, mix olive oil, lemon zest and juice, minced garlic, oregano, salt, and pepper to make a marinade.",
      "Place chicken breasts in a baking dish and pour the marinade over them. Let sit 10-20 minutes (or up to 2 hours in fridge).",
      "Bake in the preheated oven for 20-28 minutes, or until internal temperature reaches 165°F (74°C).",
      "Remove from oven, let rest 5 minutes, then slice and serve with pan juices spooned over."
    ]
  },
  {
    name: "Chickpea Mediterranean Bowl",
    ingredients: [
      { item: "canned chickpeas", qty: "1 can (400 g)", note: "drained and rinsed" },
      { item: "olive oil", qty: "1 tbsp" },
      { item: "tomato", qty: "1 medium", note: "chopped" },
      { item: "spinach or arugula", qty: "2 cups", note: "fresh" },
      { item: "lemon", qty: "1/2", note: "juiced" },
      { item: "ground cumin", qty: "1/2 tsp" },
      { item: "salt", qty: "to taste" },
      { item: "black pepper", qty: "to taste" }
    ],
    steps: [
      "Heat olive oil in a skillet over medium heat.",
      "Add the chickpeas and sauté for 4-6 minutes until slightly crisp. Sprinkle cumin, salt and pepper during cooking.",
      "Remove from heat and toss chickpeas with chopped tomato and fresh greens in a bowl.",
      "Drizzle lemon juice and an extra splash of olive oil, toss gently and serve warm or at room temperature."
    ]
  },
  {
    name: "Greek Yogurt Parfait",
    ingredients: [
      { item: "Greek yogurt", qty: "1 cup (240 g)", note: "plain" },
      { item: "honey", qty: "1 tbsp" },
      { item: "walnuts", qty: "2 tbsp", note: "chopped" },
      { item: "berries", qty: "1/2 cup", note: "fresh or frozen" }
    ],
    steps: [
      "Spoon half the Greek yogurt into a bowl or glass.",
      "Add half the berries, then a drizzle of honey, and half the chopped walnuts.",
      "Repeat the layers with remaining yogurt, berries, honey, and walnuts.",
      "Serve immediately."
    ]
  }
];

// Utility: match recipes based on fridge items (case-insensitive substring match)
function findMatchingRecipes(fridgeItems) {
  const items = fridgeItems.map(i => i.toLowerCase().trim()).filter(Boolean);
  if (items.length === 0) return [];

  // Score recipes by how many ingredient tokens match
  return recipes
    .map(recipe => {
      const required = recipe.ingredients.map(ing => ing.item.toLowerCase());
      let matches = 0;
      for (const it of items) {
        for (const req of required) {
          // simple fuzzy match: check if fridge item contains required token or vice versa
          if (it.includes(req) || req.includes(it)) {
            matches++;
            break;
          }
        }
      }
      return { recipe, matches, total: required.length };
    })
    .filter(r => r.matches > 0) // at least one matching ingredient
    .sort((a, b) => {
      // prefer recipes with more matches relative to total ingredients
      const aScore = a.matches / a.total;
      const bScore = b.matches / b.total;
      return bScore - aScore || b.matches - a.matches;
    })
    .map(r => r.recipe);
}

export default function MediterraneanRecipeFinder() {
  const [input, setInput] = useState("");
  const [results, setResults] = useState([]);
  const [expandedIndex, setExpandedIndex] = useState(null);

  const handleSearch = () => {
    const fridgeList = input.split(",").map(s => s.trim()).filter(Boolean);
    const matches = findMatchingRecipes(fridgeList);
    setResults(matches);
    setExpandedIndex(matches.length ? 0 : null);
  };

  return (
    <div className="min-h-screen bg-gray-50 p-8 md:p-12 flex flex-col items-center">
      <h1 className="text-4xl font-bold mb-6 text-gray-900">Mediterranean Recipe Finder</h1>

      <div className="w-full max-w-2xl bg-white shadow-lg rounded-2xl p-6">
        <label className="block text-sm font-medium text-gray-700 mb-2">Enter your fridge ingredients (comma-separated):</label>
        <input
          className="w-full border border-gray-300 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-green-300"
          placeholder="e.g. canned chickpeas, lemon, olive oil, cucumber, parsley"
          value={input}
          onChange={(e) => setInput(e.target.value)}
        />

        <div className="flex gap-3 mt-4">
          <button
            onClick={handleSearch}
            className="flex-1 bg-green-600 text-white p-3 rounded-xl hover:bg-green-700 transition"
          >
            Find Recipes
          </button>
          <button
            onClick={() => { setInput(''); setResults([]); setExpandedIndex(null); }}
            className="px-4 py-3 rounded-xl border border-gray-200 bg-white"
          >
            Clear
          </button>
        </div>

        <div className="mt-6">
          {results.length === 0 ? (
            <p className="text-gray-500">No recipes found. Try adding more common ingredients like olive oil, lemon, or garlic.</p>
          ) : (
            results.map((r, i) => (
              <div key={i} className="border border-gray-100 rounded-xl p-4 mb-4 bg-gray-50">
                <div className="flex justify-between items-start">
                  <div>
                    <h2 className="text-xl font-semibold text-gray-900">{r.name}</h2>
                    <p className="text-sm text-gray-600">Matches { /* show how many fridge items matched? */ }</p>
                  </div>
                  <div>
                    <button
                      onClick={() => setExpandedIndex(expandedIndex === i ? null : i)}
                      className="text-sm text-blue-600 hover:underline"
                    >
                      {expandedIndex === i ? 'Hide' : 'View'}
                    </button>
                  </div>
                </div>

                {expandedIndex === i && (
                  <div className="mt-3">
                    <h3 className="font-medium text-gray-800 mb-2">Ingredients</h3>
                    <ul className="list-disc list-inside text-gray-700 mb-3">
                      {r.ingredients.map((ing, idx) => (
                        <li key={idx}><strong>{ing.qty}</strong> {ing.item}{ing.note?` — ${ing.note}`:''}</li>
                      ))}
                    </ul>

                    <h3 className="font-medium text-gray-800 mb-2">Step-by-step Instructions</h3>
                    <ol className="list-decimal list-inside text-gray-700 space-y-2">
                      {r.steps.map((s, stepIdx) => (
                        <li key={stepIdx}>{s}</li>
                      ))}
                    </ol>
                  </div>
                )}
              </div>
            ))
          )}
        </div>
      </div>

      <div className="w-full max-w-2xl mt-8 text-sm text-gray-500">
        <p>Tip: include simple pantry items in your input (e.g., olive oil, salt, pepper, lemon) so the generator can suggest complete recipes.</p>
      </div>
    </div>
  );
}
